#!/bin/bash

now=$(TZ=":Europe/Moscow" date +"%F")
nowSec=$(date -d "$now" +"%s")

sourcePath="/home/nekosmonavt/source/"
backupReport="/home/nekosmonavt/backup-report"

haveRecentBackup=0
for dir in $(ls /home/nekosmonavt/ | grep -E "^Backup-[0-9]{4}-[0-9]{2}-[0-9]{2}$");
do
	lastTimeBackup=$(echo $dir | sed 's/^Backup-//')
	lastBackupSec=$(date -d "$lastTimeBackup" +"%s")
	let dDays=($nowSec-$lastBackupSec)/86400
	if [[ $dDays -lt "7" ]];
	then 
		haveRecentBackup=1
		break
	fi	
done


if [[ $haveRecentBackup -eq "0" ]];
then
	newDir="Backup-$now"
	mkdir /home/nekosmonavt/$newDir
	for sourceFile in $sourcePath*;
	do
		newFileName=$(echo $sourceFile | sed "s/source/${newDir}/")
		cp $sourceFile $newFileName
	done
	echo "- $newDir created at $now . Files:" >> $backupReport
	ls /home/nekosmonavt/$newDir >> $backupReport
else
	for sourceFile in $sourcePath*;
	do
		sourceFName=$(echo $surceFile | sed "s/${sourcePath}//")
		for alreadyBackupedFile in $dir*;
		do
			currentFileName=$(echo $alreadyBackupedFile | sed "s/${dir}//")
			if [[ $currentFileName == $sourceFName ]];
			then
				if cmp -s $sourceFile $alreadyBackupedFile ; then
					
			else
			fi
		done
	done
fi
